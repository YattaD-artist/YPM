<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ao Sen Hà Đông</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      transition: background 1s;
    }
    .sky {
      position: relative;
      width: 100%;
      height: 70vh;
      background: #87ceeb;
      overflow: hidden;
      transition: background 1s;
    }
    .pond {
      width: 100%;
      height: 30vh;
      background: #2d5000;
    }
    .lotus {
      position: absolute;
      bottom: 10%;
      left: 50%;
      width: 200px;
      transform: translateX(-50%);
    }
    .controls {
      padding: 10px;
      background: rgba(255,255,255,0.8);
    }
    .cloud, .raindrop {
      position: absolute;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
    }
    .cloud {
      width: 200px; height: 60px;
      top: 10%;
      left: -200px;
      animation: float 20s linear infinite;
    }
    @keyframes float {
      0% { left: -200px; }
      100% { left: 100%; }
    }
    .raindrop {
      width: 5px; height: 15px;
      background: lightblue;
      animation: fall 1s linear infinite;
    }
    @keyframes fall {
      0% { top: 0; opacity: 1; }
      100% { top: 100%; opacity: 0; }
    }
    .wind {
      animation: sway 3s infinite alternate;
    }
    @keyframes sway {
      from { transform: translateX(-5px); }
      to { transform: translateX(10px); }
    }
    #info {
      padding: 12px;
      font-weight: bold;
      background: rgba(255,255,255,0.7);
    }
  </style>
</head>
<body>
  <div class="sky" id="sky">
    <img src="https://i.imgur.com/ypxYb6r.png" class="lotus" alt="Hoa sen">
  </div>
  <div class="pond"></div>
  <div id="info">Đang tải thời tiết Hà Đông...</div>

<script>
const sky = document.getElementById('sky');
const lotus = document.querySelector('.lotus');
const info = document.getElementById('info');

const API_KEY = '7787f162c8017c9c97a8a9ac9c271644';
const lat = 20.961, lon = 105.768;

async function getWeather() {
  try {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=vi&appid=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    console.log(data);

    const condition = data.weather[0].main.toLowerCase(); // 'clear', 'clouds', 'rain'...
    const temp = data.main.temp;
    const wind = data.wind.speed;

    // xử lý trời
    if (condition.includes('rain')) {
      setSkyRainy();
    } else if (condition.includes('cloud')) {
      setSkyCloudy();
    } else {
      setSkySunny();
    }

    // xử lý gió
    if (wind > 5) {
      lotus.classList.add('wind');
    }

    // cập nhật info
    info.innerText = `Trạng thái: ${data.weather[0].description} | Nhiệt độ: ${temp}°C | Gió: ${wind} m/s`;
  } catch (e) {
    info.innerText = "Lỗi khi tải dữ liệu thời tiết!";
    console.error(e);
  }
}

function setSkySunny() {
  sky.style.background = '#87ceeb';
  removeWeatherElements();
}

function setSkyCloudy() {
  sky.style.background = '#b0c4de';
  removeWeatherElements();
  for (let i = 0; i < 3; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'cloud';
    cloud.style.top = `${10 + i * 10}%`;
    sky.appendChild(cloud);
  }
}

function setSkyRainy() {
  sky.style.background = '#708090';
  removeWeatherElements();
  for (let i = 0; i < 30; i++) {
    const drop = document.createElement('div');
    drop.className = 'raindrop';
    drop.style.left = `${Math.random() * 100}%`;
    drop.style.animationDelay = `${Math.random()}s`;
    sky.appendChild(drop);
  }
  setSkyCloudy();
}

function removeWeatherElements() {
  document.querySelectorAll('.cloud, .raindrop').forEach(el => el.remove());
}

getWeather();
</script>
</body>
</html>
